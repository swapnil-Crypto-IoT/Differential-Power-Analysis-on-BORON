/*****************************************************************************************
		Subroutine for the masked inverse-sbox implementation
******************************************************************************************/

#include<stdio.h>
#include<stdlib.h>

unsigned long long int invmsbox(unsigned long long int masks, unsigned long long int c)
{
	unsigned long long int i,j[16]={0},a=0,t[16]={0};
	unsigned long long int mask_table1[16][16]=    {{0xa,0x3,0x9,0xe,0x1,0xd,0xf,0x4,0xc,0x5,0x7,0x2,0x6,0x8,0x0,0xb,},
{0x2,0xb,0xf,0x8,0xc,0x0,0x5,0xe,0x4,0xd,0x3,0x6,0x9,0x7,0xa,0x1,},
{0xb,0xc,0x8,0x1,0xd,0x6,0x3,0xf,0x5,0x0,0xe,0x7,0x2,0x9,0x4,0xa,},
{0xd,0xa,0x0,0x9,0x7,0xc,0xe,0x2,0x1,0x4,0x6,0xf,0x8,0x3,0xb,0x5,},
{0x5,0x9,0xb,0x0,0xe,0x7,0xd,0xa,0x2,0xc,0x4,0xf,0x8,0x1,0x3,0x6,},
{0x8,0x4,0x1,0xa,0x6,0xf,0xb,0xc,0xd,0x3,0xe,0x5,0x0,0x9,0x7,0x2,},
{0x9,0x2,0x7,0xb,0xf,0x8,0xc,0x5,0x6,0xd,0x0,0xe,0x1,0x4,0xa,0x3,},
{0x3,0x8,0xa,0x6,0x9,0xe,0x4,0xd,0xc,0x7,0xf,0x1,0x5,0x0,0x2,0xb,},
{0x4,0xd,0xf,0xa,0xe,0x0,0x8,0x3,0x2,0xb,0x1,0x6,0x9,0x5,0x7,0xc,},
{0xc,0x5,0xb,0xe,0x1,0xf,0x2,0x9,0xa,0x3,0x7,0x0,0x4,0x8,0xd,0x6,},
{0xd,0x8,0x6,0xf,0xa,0x1,0xc,0x2,0x3,0x4,0x0,0x9,0x5,0xe,0xb,0x7,},
{0x9,0xc,0xe,0x7,0x0,0xb,0x3,0xd,0x5,0x2,0x8,0x1,0xf,0x4,0x6,0xa,},
{0xa,0x4,0xc,0x7,0x0,0x9,0xb,0xe,0xd,0x1,0x3,0x8,0x6,0xf,0x5,0x2,},
{0x5,0xb,0x6,0xd,0x8,0x1,0xf,0xa,0x0,0xc,0x9,0x2,0xe,0x7,0x3,0x4,},
{0xe,0x5,0x8,0x6,0x9,0xc,0x2,0xb,0x1,0xa,0xf,0x3,0x7,0x0,0x4,0xd,},
{0x4,0xf,0x7,0x9,0xd,0x8,0xa,0x3,0xb,0x0,0x2,0xe,0x1,0x6,0xc,0x5,},
};



		for(i=0;i<16;i++)
		{
			t[15-i] = (masks>>(i*4))&0xf;
		}
		
		/*printf("\n");
		for(i=0;i<16;i++)
		{
			printf(" %llx ",t[i]);
		}
		printf("\n");*/
	a=0;
   	for (i=0;i<64;i=i+4)     
	{
	 j[((i*1)/4)] = mask_table1[t[((i*1)/4)]][((c>>(60-i)&0xf))];
	 a |= ((((j[((i*1)/4)])&0xf)<<(60-i)));
	}
//	printf("\n in function %llx", a);
	return(a);
}

